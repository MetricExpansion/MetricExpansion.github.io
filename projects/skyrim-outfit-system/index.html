<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Skyrim Outfit System Revived - MetricExpansion</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="Skyrim Outfit System Revived"><meta itemprop=description content="Skyrim Outfit System Revived is my attempt to resurrect an excellent Skyrim SE mod created by DavidJCobb and aers. The release package is available on the Skyrim SE Nexus. The complete source code is on GitLab.
The basic concept is to allow the player to decouple the appearance of their armor from its stats. Here&rsquo;s a little video that shows how this mod works.

It&rsquo;s a really great thing to have because it solves the problem of having an armor whose appearance you like, but then coming across a new armor with better stats but with an appearance you hate."><meta itemprop=wordCount content="821"><meta itemprop=keywords content><meta property="og:title" content="Skyrim Outfit System Revived"><meta property="og:description" content="Skyrim Outfit System Revived is my attempt to resurrect an excellent Skyrim SE mod created by DavidJCobb and aers. The release package is available on the Skyrim SE Nexus. The complete source code is on GitLab.
The basic concept is to allow the player to decouple the appearance of their armor from its stats. Here&rsquo;s a little video that shows how this mod works.

It&rsquo;s a really great thing to have because it solves the problem of having an armor whose appearance you like, but then coming across a new armor with better stats but with an appearance you hate."><meta property="og:type" content="article"><meta property="og:url" content="http://metricexpansion.com/projects/skyrim-outfit-system/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Skyrim Outfit System Revived"><meta name=twitter:description content="Skyrim Outfit System Revived is my attempt to resurrect an excellent Skyrim SE mod created by DavidJCobb and aers. The release package is available on the Skyrim SE Nexus. The complete source code is on GitLab.
The basic concept is to allow the player to decouple the appearance of their armor from its stats. Here&rsquo;s a little video that shows how this mod works.

It&rsquo;s a really great thing to have because it solves the problem of having an armor whose appearance you like, but then coming across a new armor with better stats but with an appearance you hate."><link href="https://fonts.googleapis.com/css?family=Playfair+Display:700" rel=stylesheet type=text/css><link rel=stylesheet type=text/css media=screen href=http://metricexpansion.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=http://metricexpansion.com/css/main.css><link id=dark-scheme rel=stylesheet type=text/css href=http://metricexpansion.com/css/dark.css><script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script><script src=http://metricexpansion.com/js/main.js></script></head><body><div class="container wrapper"><div class=header><div class=avatar><a href=http://metricexpansion.com/><img src=/images/profile.jpg alt=MetricExpansion></a></div><h1 class=site-title><a href=http://metricexpansion.com/>MetricExpansion</a></h1><div class=site-description><p>a hacker who does very few things</p><nav class="nav social"><ul class=flat><li><a href=https://github.com/MetricExpansion title=Github><i data-feather=github></i></a></li><li><a href=https://gitlab.com/metricexpansion title=Gitlab><i data-feather=gitlab></i></a></li></ul></nav><span class=scheme-toggle><a href=# id=scheme-toggle></a></div><nav class=nav><ul class=flat><li><a href=/>Home</a></li><li><a href=/about/>About</a></li><li><a href=/posts/>Posts</a></li><li><a href=/projects/>Projects</a></li></ul></nav></div><div class=post><div class=post-header><div class=matter><h1 class=title>Skyrim Outfit System Revived</h1></div></div><div class=markdown><p><strong>Skyrim Outfit System Revived</strong> is my attempt to resurrect an excellent Skyrim SE mod created by DavidJCobb and aers. The release package is available on the <a href=https://www.nexusmods.com/skyrimspecialedition/mods/42162>Skyrim SE Nexus</a>. The complete source code is on <a href=https://gitlab.com/metricexpansion/SkyrimOutfitSystemSE>GitLab</a>.</p><p>The basic concept is to allow the player to decouple the appearance of their armor from its stats. Here&rsquo;s a little video that shows how this mod works.</p><p><video style=width:100% controls src=https://cdn.metricexpansion.com/file/avipublicfiles/The+Elder+Scrolls+V++Skyrim+Special+Edition+2020.10.29+-+21.44.43.01.mp4></video></p><p>It&rsquo;s a really great thing to have because it solves the problem of having an armor whose appearance you like, but then coming across a new armor with better stats but with an appearance you hate. It also helps mitigate the problem of not having the complete set of an armor and looking like a Frankenstein. No other mod solves these issues as transparently as Skyrim Outfit System, because it&rsquo;s the only one that actually patches the way the game decides how it &ldquo;skins&rdquo; the player.</p><h2 id=left-to-rot>Left to rot</h2><p>DavidJCobb made the original version for Skyrim LE. aers then ported that mod to Skyrim SE 1.5.73. However, the port used hard-coded addresses which made it non-portable between different versions of Skyrim SE. Worse, it had a dependency on a custom fork of a library called CommonLibSSE (CLS). CLS is a support library that reconstructs the class definitions used by the game, among other things. It was also coded using fixed addresses. The mod also depended on SKSE as well, which also uses fixed addresses.</p><p>Some time later, a new version of CLS became available that leveraged the Address Library for SKSE. However, it also completely changed the interface and so upgrading to it became a non-trivial task.</p><p>For these reasons and others, it seems that aers decided to put the development on hold until he found time to work on upgrading the mod. That was in 2019.</p><h2 id=picking-up-the-torch>Picking up the torch</h2><p>Since it had been a while since development was suspended, I decided to dive into this and see what it would take to not only update the mod for the latest Skyrim runtime (currently 1.5.97), but to actually make it compatible with <em>any</em> version of the game! As someone who is a competent C++ programmer, but not a reverse-engineer, this was certainly an interesting learning experience.</p><h3 id=commonlibsse>CommonLibSSE</h3><p>After discovering the aforementioned situation, I got to work trying to refurbish the mod. I was able to first update the mod to the newest version of CLS. I combed through the mod looking for everywhere the new version of the CLS broke the interface and fixed it up.</p><p>Then I replayed aers&rsquo;s change to CLS. They amounted to a few additions to the reconstructed classes. Of course, I tried to use Address Library identifiers rather than hard-coded offsets in the new member definitions.</p><h3 id=game-hooking-code>Game Hooking Code</h3><p>With CLS now fixed up, my next step was to fix the mod itself. I went through all the addresses defined by the mod and changed them to use Address Library offsets as well. Some addresses were actually in the middle of some functions (not the start). I used IDA Pro to find the starts of these functions and was able to then map them with the Address Library. I then add the difference manually. I did verify that this difference was the same across different versions of the game binary.</p><h3 id=skse>SKSE</h3><p>The final, and most difficult, task was to fix up the SKSE dependency. SKSE does not publish versions that use the Address Library. Luckily, most of the interesting address accesses happen through a few helper classes. By replacing the definition of these helper classes with something that can actually use the Address Library to translate 1.5.73 addresses into the addresses of whatever game version is running, I could make SKSE version independent. To support this, I also wrote a compile-time program that will dump the Address Library database for 1.5.73 into a reverse lookup table, which gets compiled into this helper class. At runtime, I simply load the database for the running version and address to identifier to address lookup.</p><p>I don&rsquo;t really need all the addresses to work, only the ones directly required by this mod, so I have it crash if some lookup was to fail. This is a dangerous technique, because I may not have caught all game address dereferences by SKSE, but I&rsquo;m pretty confident that I have for the subset of functionality used by this mod.</p><h3 id=cmake>CMake</h3><p>Finally, I converted the entire build system to CMake, a build system I know well, so that I can coordinate all of this properly. For someone building the project from a fresh clone, all this complexity is hidden away.</p><h2 id=looking-to-the-future>Looking to the future</h2><p>Now that the mod is in good shape, I have started working on new features. They include a better quickselection menu, an option to automatically change the outfit based on location and weather, JSON export/import of outfits, and better integration with the vanilla equipping system.</p></div><div class=tags></div></div></div><div class="footer wrapper"><nav class=nav><div>2020 Â© Avinash Vakil | <a href=https://github.com/knadh/hugo-ink>Ink</a> theme on <a href=https://gohugo.io>Hugo</a></div></nav></div><script>feather.replace()</script></body></html>